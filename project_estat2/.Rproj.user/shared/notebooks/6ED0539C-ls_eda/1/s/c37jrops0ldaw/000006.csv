"0",""
"0","start_time <- Sys.time()"
"0",""
"0","f_sd <- 2"
"0","f_beta <- 0"
"0","f_pvalue <- 0.05"
"0","f_correl <- 0.6"
"0","out_signal <- 0.05"
"0",""
"0","# Gera o sinal de entrada"
"0","ls_eda$signal_t3 <- with(ls_eda, ifelse(lag(scale_t3) < f_sd & scale_t3 >= f_sd, 2,"
"0","                                      ifelse(lag(scale_t3) > -f_sd & scale_t3 <= -f_sd, -2, 0)))"
"0","# Gera o filtro de entrada"
"0","ls_eda$filter_t3 <- with(ls_eda, ifelse(beta_t3 > f_beta & pvalue_t3 < f_pvalue & correl_t3 > f_correl, 1, 0))"
"0",""
"0","# Gera o sinal de saída"
"0","ls_eda$out_t3 <- with(ls_eda, ifelse(lag(scale_t3) > out_signal & scale_t3 <= out_signal, 1,"
"0","                                   ifelse(lag(scale_t3) < -out_signal & scale_t3 >= -out_signal, -1, 0)))"
"0",""
"0","# Elimina NA da primeira linha causado pelo lag"
"0","ls_eda$signal_t3[is.na(ls_eda$signal_t3)] <- 0"
"0","ls_eda$out_t3[is.na(ls_eda$out_t3)] <- 0"
"0",""
"0","# em teoria somente a primeira linha pode ser NA"
"0","ls_eda$pos_t3 <- 0"
"0",""
"0","# Define se estou posicionado ou não"
"0","active <- 0"
"0","pos <- 0"
"0",""
"0","for(i in 2:nrow(ls_eda)){"
"0","  # Active = 0 & (Signal = 0 | Filter = 0)"
"0","  if (active == 0 & (ls_eda$signal_t3[i] == 0 | ls_eda$filter_t3[i] == 0)) {"
"0","    ls_eda$pos_t3[i] <- 0"
"0","  # Active = 0 & (Signal = 2 & Filter = 1) & Out = 0"
"0","  } else if (active == 0 & (ls_eda$signal_t3[i] == 2 & ls_eda$filter_t3[i] == 1)) {"
"0","    active <- 1"
"0","    pos <- -1"
"0","    ls_eda$pos_t3[i+1] <- pos"
"0","    # Active = 0 & (Signal = -2 & Filter = 1) & Out = 0"
"0","  } else if (active == 0 & (ls_eda$signal_t3[i] == -2 & ls_eda$filter_t3[i] == 1)) {"
"0","    active <- 1"
"0","    pos <- 1"
"0","    ls_eda$pos_t3[i+1] <- pos"
"0","    # Active = 1 & Out = 0"
"0","  } else if (active == 1 & ls_eda$out_t3[i] == 0) {"
"0","    ls_eda$pos_t3[i] <- pos"
"0","    # Active = 1 & (Signal = 2 & Filter = 1) & Out = 1"
"0","  } else if (active == 1 & (ls_eda$signal_t3[i] == 2 & ls_eda$filter_t3[i] == 1) & ls_eda$out_t3[i] != 0) {"
"0","    pos <- -1"
"0","    ls_eda$pos_t3[i+1] <- pos"
"0","    # Active = 1 & (Signal = -2 & Filter = 1) & Out = 1"
"0","  } else if (active == 1 & (ls_eda$signal_t3[i] == -2 & ls_eda$filter_t3[i] == 1) & ls_eda$out_t3[i] != 0) {"
"0","    pos <- 1"
"0","    ls_eda$pos_t3[i+1] <- pos"
"0","    # Active = 1 & (Signal = 0 & Filter = 0) & Out = 1"
"0","  } else if (active == 1 & (ls_eda$signal_t3[i] == 0 | ls_eda$filter_t3[i] == 0) & ls_eda$out_t3[i] != 0) {"
"0","    active <- 0"
"0","    ls_eda$pos_t3[i] <- pos"
"0","  }"
"0","}"
"0",""
"0",""
"0","# Gera os retornos dos dias posicionados"
"0","ls_eda$return_t3 <- with(ls_eda, ((price_l / lag(price_l)-1) - beta_t3 * (price_r / lag(price_r)-1)) * pos_t3)"
"0",""
"0","# Elimina NA da primeira linha causado pelo lag"
"0","ls_eda$return_t3[is.na(ls_eda$return_t3)] <- 0"
"0",""
"0","# Numerar a posição e o lucro"
"0","ls_eda$trade_t3 <- 0"
"0","ls_eda$sum_ret_t3 <- 0"
"0","ls_eda$open_days_t3 <- 0"
"0",""
"0","active <- 0"
"0","open_line <- 0"
"0","counter <- 0"
"0","count_days <- 0"
"0","sum_ret <- 0"
"0",""
"0","for(i in 1:nrow(ls_eda)){"
"0","  # Active = 0 & Signal = 0"
"0","  if(active == 0 & (ls_eda$signal_t3[i] == 0 | ls_eda$filter_t3[i] == 0)){"
"0","    # Active = 0 & Signal = 1"
"0","  } else if (active == 0 & (ls_eda$signal_t3[i] != 0  & ls_eda$filter_t3[i] != 0)) {"
"0","    active <- 1"
"0","    open_line <- i"
"0","    counter <- counter + 1"
"0","    ls_eda$trade_t3[i] <- counter"
"0","    sum_ret <- 0"
"0","    count_days <- 0"
"0","    # Active = 1 & Out = 0 & Signal = 0"
"0","  } else if (active == 1 & ls_eda$out_t3[i] == 0 & (ls_eda$signal_t3[i] == 0 | ls_eda$filter_t3[i] == 0)) {"
"0","    sum_ret <- sum_ret + ls_eda$return_t3[i]"
"0","    count_days <- count_days + 1"
"0","    # Active = 1 & Out = 0 & Signal = 1"
"0","  } else if(active == 1 & ls_eda$out_t3[i] == 0 & (ls_eda$signal_t3[i] != 0 & ls_eda$filter_t3[i] != 0)) {"
"0","    sum_ret <- sum_ret + ls_eda$return_t3[i]"
"0","    count_days <- count_days + 1"
"0","    # Active = 1 & Out = 1 & Signal = 0"
"0","  } else if (active == 1 & ls_eda$out_t3[i] != 0 & (ls_eda$signal_t3[i] == 0 | ls_eda$filter_t3[i] == 0)) {"
"0","    sum_ret <- sum_ret + ls_eda$return_t3[i]"
"0","    count_days <- count_days + 1"
"0","    ls_eda$sum_ret_t3[open_line] <- sum_ret"
"0","    ls_eda$open_days_t3[open_line] <- count_days"
"0","    sum_ret <- 0"
"0","    count_days <- 0"
"0","    active <- 0"
"0","    # Active = 1 & Out = 1 & Signal = 1"
"0","  } else if(active == 1 & ls_eda$out_t3[i] != 0 & (ls_eda$signal_t3[i] != 0 & ls_eda$filter_t3[i] != 0)) {"
"0","    sum_ret <- sum_ret + ls_eda$return_t3[i]"
"0","    count_days <- count_days + 1"
"0","    ls_eda$sum_ret_t3[open_line] <- sum_ret"
"0","    ls_eda$open_days_t3[open_line] <- count_days"
"0","    open_line <- i"
"0","    counter <- counter + 1"
"0","    ls_eda$trade_t3[i] <- counter"
"0","    sum_ret <- 0"
"0","    count_days <- 0"
"0","  } else {print(c(active, ls_eda$out_t3[i], ls_eda$signal_t3[i], ls_eda$filter_t3[i]))}"
"0","}"
"0",""
"0","end_time <- Sys.time()"
"0",""
"0","end_time - start_time"
"1","Time difference of "
"1",""
"1","1.778321"
"1",""
"1"," "
"1",""
"1","hours"
"1",""
"1","
"
